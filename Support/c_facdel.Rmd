---
title: "c_facdel"
author: "Haozheyi Guan"
date: "4/28/2020"
output: html_document
---

```{r c_facdel}
library(foreign)
common_path = "C:/Users/Guan/OneDrive/DHS/MEASURE UHC DATA/RAW DATA/Recode VII"
primary_dirs = list.files(common_path)
primary_dirs
main_data = data.frame()

for (dir in primary_dirs) {
  birth <- list.files(paste(common_path,dir,sep = "/"),pattern = "*birth")
 #there is a file with birth.dta in this directory read it in append to a data.frame
  for (dta in birth) {
  temp_data <- read.dta(paste(common_path,dir,sep="/",dta))
  ctr <- unique(temp_data$v000)
  temp_data <- as.data.frame(attr(temp_data,"var.labels"))
  names(temp_data)<-"name"
  temp_data<-filter(temp_data,grepl("^place of delivery",temp_data$name,ignore.case = TRUE))%>%mutate(country = ctr)
  main_data <- rbind(main_data,temp_data)
  }
}

main_data$name<-tolower(main_data$name)
main_data_2<-distinct(main_data)

skilled <- c("other","shop","pharmacy","market","kiosk","relative","friend", "church","drug","addo","hilot","traditional","cs private medical","cs public sector","no treatment") 
unskilled <- c("ngo","hospital","medical center","traditional practioner$")
#"na^", not in the list

a<-grepl(main_data_2$name,pattern = paste(skilled,collapse = "|"),ignore.case = TRUE)
b<-!grepl(main_data_2$name,pattern = paste(unskilled,collapse = "|"),ignore.case = TRUE)   

main_data_2<- mutate(main_data_2,c_hospdel = ifelse(a&b,0,1))
var_list_2<- distinct(select(main_data_2,1,3))

paste(skilled,collapse = "|")
paste(unskilled,collapse = "|")
write.csv(var_list_2,"c_hospdel.csv")
```



